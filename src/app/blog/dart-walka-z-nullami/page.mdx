import { me, siteMetadata } from '@/lib/data';
import image from './image.jpg';

export const article = {
  date: '2020-01-15',
  title: 'Dart i walka z nullami',
  description:
    'Pomimo tego, Å¼e Dart to stosunkowo nowy jÄ™zyk, to wiele mu brakuje do jego konkurencji. Oto jak poradziÄ‡ sobie z nullami.',
  author: me,
  image,
  lang: 'pl'
};

export const metadata = {
  title: article.title,
  description: article.description,
  author: { name: article.author.name },
  ...siteMetadata,
  keywords: ['flutter', 'dart'],
};

# Dart i walka z nullami

Pomimo swojego mÅ‚odego wieku i wpÅ‚ywu z innych jÄ™zykÃ³w programowania Dart tak naprawdÄ™ nie posiada mechanizmu *null safety*, czyli zapobiegania bÅ‚Ä™dom zwiÄ…zanym z jego niespodziewanymi wystÄ…pieniami. Dart w swojej standardowej bibliotece nie ma nawet prostego Optionala z Javy, mimo Å¼e jest banalny do napisania. StÄ…d nie dziwiÄ… mnie narzekania ludzi przechodzÄ…cych z Swifta czy Kotlina.

Co prawda kilka dni temu wyszedÅ‚ Dart w wersji 2.7 a z nim pokazÃ³wka nowego systemu typÃ³w, ktÃ³ry uwzglÄ™dnia *null safety*. Jest to dosyÄ‡ drastyczna zmiana, bo zupeÅ‚nie Å‚amie kompatybilnoÅ›Ä‡ wstecznÄ…. OczywiÅ›cie jest to tylko taka pokazÃ³wka dla programistÃ³w, wiÄ™c wszystko moÅ¼e siÄ™ zmieniÄ‡, ale sama idea prawdopodobnie pozostanie taka sama. MoÅ¼esz Å›ledziÄ‡ postÄ™py [tutaj](https://github.com/dart-lang/language/issues/110), jak i przeczytaÄ‡ o samym [zamyÅ›le](https://github.com/dart-lang/language/blob/master/accepted/future-releases/nnbd/roadmap.md) tej zmiany.

DziÅ› natomiast chciaÅ‚bym pokazaÄ‡ jak moÅ¼na wykorzystaÄ‡ inne elementy skÅ‚adni Darta, ktÃ³re mogÄ… nam pomÃ³c rozprawiÄ‡ siÄ™ z nullami. BÄ™dzie teÅ¼ przykÅ‚ad wymienionej pokazÃ³wki.

Zanim zaczniemy, kod w wersji angielskiej moÅ¼na sobie odpaliÄ‡ na [tym DartPadzie](https://dartpad.dev/1b123ec2a2923a27ab667ed4f4255e9e).

## Null coalescing operator
*Null coalescing operator* czy teÅ¼ jak dokumentacja Darta to nazywa â€” *if null operator* to po prostu podwÃ³jny znak zapytania `??` ktÃ³ry sprawdza nam czy obiekt jest nullem. JeÅ›li obiekt nie jest nullem to jest on zwrÃ³cony, a jeÅ›li jest nullem to drugie wyraÅ¼enie jest wykonywane i jego wartoÅ›Ä‡Â zwracana. 

Jest to mega uÅ¼yteczne przy ustawianiu domyÅ›lnych wartoÅ›ci czy scalaniu dwÃ³ch obiektÃ³w. WeÅºmy sobie takie proste Hello World jako przykÅ‚ad:
```dart
void sayHello({ String to }) {
  String secondPart = to ?? "world";
  print("Hello " + secondPart);
}

sayHello(); // -> Hello world
sayHello(to: "Dart"); // -> Hello Dart
```

Tutaj `??` pomaga nam uniknÄ…Ä‡ `ArgumentError` gdybyÅ›my przekazali nulla do parametru `to` poprzez dodawanie domyÅ›lnej wartoÅ›ci. Ten kodzik moÅ¼emy jeszcze trochÄ™ ulepszyÄ‡ wprowadzajÄ…c dodatkowo przypisanie za pomocÄ… `??=`.
```dart
void sayHello({ String to }) {
  to ??= "world";
  print("Hello " + to);
}
```
ChoÄ‡Â oczywiÅ›cie ten przykÅ‚ad jest trochÄ™ gÅ‚upi, bo w tym przypadku moÅ¼na domyÅ›lnÄ… wartoÅ›Ä‡Â ustawiÄ‡ na poziomie parametrÃ³w.
```dart
void sayHello({ String to = "world" }) {
  print("Hello " + to);
}
```

## Conditional member access
`??` jest przydatne, ale najczÄ™stszym bÅ‚Ä™dem z jakim siÄ™ spotykamy walczÄ…c z nullami to `NoSuchMethodError`. Dostajemy go, bo prÃ³bujemy odnieÅ›Ä‡ siÄ™ do jakiegoÅ›Â pola obiektu, ktÃ³rego nie ma, bo obiekt jest akurat nullem. By tego uniknÄ…Ä‡ moÅ¼emy wstawiÄ‡ znak zapytania przed kropkÄ… â€” `?.` zanim sprÃ³buje rzeczywiÅ›cie odnieÅ›Ä‡ siÄ™ do pola sprawdzi najpierw czy przypadkiem obiekt nie jest nullem i jeÅ›li bÄ™dzie to przerwie swojÄ… pracÄ™ i sam zwrÃ³ci nulla.

```dart
void mail() {
  RegExp emailDomainRegExp = new RegExp('hello@(.+)');

  // DziÄ™ki naszemu ?. nasz program siÄ™ nie wysypie na drugim mailu
  String email = "hello@4fun.dev";
  String domain = emailDomainRegExp.matchAsPrefix(email)?.group(1);
  String domain2 = emailDomainRegExp.matchAsPrefix("itwillnotmatch")?.group(1);

  print("domain: $domain, domain2: $domain2");
}
```
W tym przykÅ‚adzie jeÅ›li nasz email nie przejdzie wyraÅ¼enia to nasz program zamiast siÄ™ wysypaÄ‡ po prostu wyÅ›wietli wartoÅ›Ä‡Â null.

Uwaga: jeÅ›li juÅ¼ raz uÅ¼yjesz `?.` to praktycznie zawsze bÄ™dziesz chciaÅ‚ to zrobiÄ‡ w kolejnych odniesieniach. PamiÄ™taj, Å¼e `?.` zwraca nulla, ale nie przerywa operacji za sobÄ….

```dart
void main() {
  String a;
  
  // Bezpieczne
  print(a?.toLowerCase()?.toUpperCase());
  
  // Wyrzuci NoSuchMethodError
  print(a?.toLowerCase().toUpperCase());
}
```

## Null-aware spread operator
Ostatni trik jest tak unikalny, Å¼e prawdopodobnie zostanie jednym z klasycznych pytaÅ„ rekrutacyjnych Fluttera/Darta. Zasada dziaÅ‚ania jest prosta â€” po prostu nie prÃ³buje wypakowaÄ‡ siÄ™ jeÅ›li jest nullem.

```dart
void main() {
  var listA = [1, 2, 3, 4, 5];
  var listB;
  
  print([...listA, ...?listB]); // -> [1, 2, 3, 4, 5]
  
  // Null-aware spread operator nie filtruje nulli!
  var listC = [6, 7, null, 9];
  print([...listA, ...?listC]); // -> [1, 2, 3, 4, 5, 6, 7, null, 9]
}
```

![Mem: Nie dostaniesz NPE jeÅ›li nie uÅ¼ywasz nulli](./mem.jpeg)

## Null safety
Ten caÅ‚y lukier skÅ‚adniowy tak naprawdÄ™ nie chroni ciÄ™ przed niespodziewanymi nullami, ale raczej sprawia, Å¼e Å‚atwiej je obsÅ‚ugiwaÄ‡. To siÄ™ zmieni. 

W skrÃ³cie, na podstawie ostatniej pokazÃ³wki i dokumentacji: BÄ™dzie jak w Kotlinie/Swiftcie czyli aktualne typy np. `int` zostanÄ… typami nie nullowalnymi a `int?` bÄ™dzie typem nullowalnym, ktÃ³ry bÄ™dzie wymagaÅ‚ sprawdzenia przed uÅ¼yciem. Taka zmiana bÄ™dzie wymagaÅ‚a okresu przejÅ›ciowego, aby projekty mogÅ‚y spokojnie, **indywidualnie** migrowaÄ‡ swÃ³j kod.

PrzykÅ‚ad tego nowego systemu typÃ³w moÅ¼na zobaczyÄ‡ na tym [specjalnym DartPadzie](https://nullsafety.dartpad.dev/1ede47fde8adf5d4dab09bcf6ddf1ec6).

## Podsumowanie
Dart moÅ¼e nie ma najbezpieczniejszego systemu typÃ³w, ale jest wystarczajÄ…cy, w koÅ„cu to trochÄ™ takie dziecko JavaScriptu i Javy. Mam nadziejÄ™, Å¼e triki jakie wam dzisiaj pokazaÅ‚em oszczÄ™dzÄ… kilka linijek klasycznego if null. Celem tego artykuÅ‚u byÅ‚o sprawienie byÅ›cie mimo wszystko nie pisali kodu jak w Javie z 2011. Z pozytywÃ³w dobrze jest powiedzieÄ‡, Å¼e Dart ciÄ…gle siÄ™ rozwija i na horyzoncie jest wspaniaÅ‚a przyszÅ‚oÅ›Ä‡, przede wszystkim dla tych co przechodzÄ… z Kotlina czy z Swifta.

WesoÅ‚ego Kodowania ğŸ’™


