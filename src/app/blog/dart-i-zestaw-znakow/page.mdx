import { me, siteMetadata } from '@/lib/data';
import image from './image.jpg';

export const article = {
  date: '2020-03-10',
  title: 'Dart i zestawy znakÃ³w',
  description:
    'Analiza przypadku brakujÄ…cych zestawÃ³w znakÃ³w i prÃ³b dostarczenia ich',
  author: me,
  image,
  lang: 'pl'
};

export const metadata = {
  title: article.title,
  description: article.description,
  author: { name: article.author.name },
  ...siteMetadata,
  keywords: ['flutter', 'dart'],
};

# Dart i zestawy znakÃ³w

PracowaÅ‚em nad aplikacjÄ…, ktÃ³ra planowaÅ‚a wykorzystaÄ‡ drukarki termiczne. Jestem teÅ¼ aktywnym uÅ¼ytkownikiem Stack Overflow i czÄ™sto poluje na ciekawe pytania, zwÅ‚aszcza z tagu Fluttera i wtedy zobaczyÅ‚em [to pytanie](https://stackoverflow.com/q/59475607/4698611):
 
> How to print Asian languages to a thermal printer from Flutter?
 
Po krÃ³tkiej analizie paczki odpowiedÅº wydawaÅ‚a siÄ™ dosyÄ‡ prosta. Paczka do drukowania po prostu nie obsÅ‚uguje wielu jÄ™zykÃ³w i trzeba rÄ™cznie wysyÅ‚aÄ‡ bajty. MoÅ¼na teÅ¼ dodaÄ‡ po prostu wsparcie i voila! CÃ³Å¼, gdyby to byÅ‚o takie proste to bym posta nie pisaÅ‚.
 
## Dartowi wiele brakuje
MoÅ¼esz kochaÄ‡ ten jÄ™zyk, ale prawdÄ… jest, Å¼e Dartowi brakuje wiele maÅ‚ych funkcji. Zwykle jakoÅ› sobie radzimy, ale w tym przypadku jest to naprawdÄ™ trudne.
 
Okazuje siÄ™, Å¼e Dart nie wspiera wielu kodowaÅ„. WÅ‚aÅ›nie obsÅ‚uguje tylko dwa: UTF-8 i Latin1, czyli ISO-8859â€“1. To oznacza, Å¼e obsÅ‚uÅ¼onych jest tylko kilka europejskich jÄ™zykÃ³w. Polski siÄ™ nie zalicza do tej grupy.

![Strona znakÃ³w Windows 1250/caption](./windows1250.png)
*Tak wyglÄ…da strona kodowa Windows 1250. UÅ¼ywana m.in. do kodowania polskiego, czeskiego, chorwackiego czy sÅ‚owackiego. Dart jej nie obÅ‚uguje.*
 
### Szukanie rozwiÄ…zania
Pierwsze co zrobiÅ‚em to przeszukaÅ‚em pub.dev. ZnalazÅ‚em tylko kilka paczuszek, z czego wiÄ™kszoÅ›Ä‡ z nich to wsparcie dla chiÅ„skiego GBK, czyli kodowania do uproszczonego chiÅ„skiego. Ich implementacja jest dosyÄ‡ prosta, ale rozlegÅ‚a, bo jest to zwykÅ‚a mapa liczby do liczby na jakieÅ› 24 tysiÄ…ce kluczy. W taki sposÃ³b moÅ¼na obsÅ‚uÅ¼yÄ‡ wiele jÄ™zykÃ³w, ale raz, Å¼e nie chce mi siÄ™ szukaÄ‡ takich mapowaÅ„ a dwa, Å¼e sÄ… kodowania, ktÃ³re nie mogÄ… byÄ‡ w taki sposÃ³b zmapowane.
 
ZnalazÅ‚em teÅ¼ paczkÄ™, ktÃ³ra wykonywaÅ‚a tÅ‚umaczenie za pomocÄ… bindingu do kodu C biblioteki iconv, ktÃ³ra jest czÄ™Å›ciÄ… GNU. Ten sposÃ³b jest caÅ‚kiem spoko, ale ten mechanizm w Flutterze jest wciÄ…Å¼ w fazie beta. SamÄ… paczkÄ™ prÃ³bowaÅ‚em odpaliÄ‡, ale nie dziaÅ‚aÅ‚o. ğŸ˜• PrÃ³bowaÅ‚em naprawiÄ‡, czy nawet zrobiÄ‡ samemu, ale caÅ‚y ten proces podpinania kodu natywnego jest strasznie karkoÅ‚omny a sam ekspertem z C nie jestem.
 
SpojrzaÅ‚em jak robiÄ… to inne jÄ™zyki. JavaScript okazaÅ‚ siÄ™ Å›wietnym przykÅ‚adem, bo sam w sobie nic do kodowania nie maâ€”tÄ™ funkcjÄ™ dodaje paczuszka [iconv-lite](https://www.npmjs.com/package/iconv-lite), ktÃ³ra jest napisana w czystym JSie. OczywiÅ›cie sprÃ³bowaÅ‚em sportowaÄ‡ jÄ… do Darta, ale przez to Å¼e ta biblioteczka wykonuje duÅ¼o optymalizacji nie byÅ‚o to Å‚atwe i porzuciÅ‚em ten mimo wszystko dobry pomysÅ‚.
 
### Platforma
OK, kolejny pomysÅ‚, skoro Flutter bÄ…dÅº co bÄ…dÅº ostatecznie musi dziaÅ‚aÄ‡ na jakiejÅ› platformie czyli np. Android to czemu by nie sprÃ³bowaÄ‡ wykorzystaÄ‡ moÅ¼liwoÅ›ci platformy do przekonwertowania? Okazuje siÄ™, Å¼e moÅ¼na i byÅ‚o to zaskakujÄ…co proste do zrobienia.
 
Na Androidzie wykorzystaÅ‚em klasÄ™ `Charset` a na iOSie `CFStringEncoding` i funkcje wokÃ³Å‚ tego. Web jest problematyczny, bo w koÅ„cu tak jak powiedziaÅ‚emâ€”JavaScript tego nie implementuje, ale zawsze moÅ¼na wykorzystaÄ‡ iconv-lite.
 
OczywiÅ›cie wykorzystanie platformy niesie ze sobÄ… bolesne skutki, ale w tym przypadku nie jest Åºle. Nazwy kodowaÅ„ sÄ… w miarÄ™ ustandaryzowane, tak samo aliasy. Jedyne co kod platformy musi zrobiÄ‡ to przerobiÄ‡ ciÄ…g znakÃ³w na bajty i na odwrÃ³t. Ewentualnie dobrze by byÅ‚o mÃ³c sprawdziÄ‡ jakie kodowania sÄ… dostÄ™pne.
 
### RozwiÄ…zanie
Skoro juÅ¼ tak siÄ™ zagÅ‚Ä™biÅ‚em w ten temat to pomyÅ›laÅ‚em czemu by nie stworzyÄ‡ czegoÅ› co by naprawiÅ‚o ten problem w duÅ¼ej skaliâ€”mi by wystarczyÅ‚ sam jÄ™zyk polski. W taki sposÃ³b, tuÅ¼ przed Nowym Rokiem, w podrÃ³Å¼y na imprezÄ™, stworzyÅ‚em swojÄ… pierwszÄ… FlutterowÄ… paczuszkÄ™â€”[charset_converter](https://pub.dev/packages/charset_converter). Nie jest moÅ¼e najszybsza, ale speÅ‚nia swoje zadanie.
 
DziÄ™ki swoim badaniom i moÅ¼liwoÅ›ci zweryfikowanie ich na firmowej drukarce termicznej mogÅ‚em odpowiedziaÅ‚em na pytanie ze Stack Overflow i otrzymaÅ‚em wystawionÄ… nagrodÄ™ ğŸ˜
 
## Podsumowanie
To byÅ‚a dobra lekcja i zabawa. MogÄ™ teÅ¼ powiedzieÄ‡, Å¼e w jakiÅ› sposÃ³b przyczyniÅ‚em siÄ™ do sprawienia by Flutter byÅ‚ bardziej dostÄ™pny dla innych kultur, nieÅºle co nie? NiedÅ‚ugo teÅ¼ napiszÄ™ posta o tym jak stworzyÄ‡ takÄ… swojÄ… paczuszkÄ™.
 
WesoÅ‚ego Kodzenia ğŸ’™


